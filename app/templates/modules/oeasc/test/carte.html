{%- import "modules/oeasc/form/form_macros.html" as macros %}


{%- extends "modules/oeasc/site/layout.html" %}


{%- block title %}{{data.type_code}}{%- endblock %}


{%- block content %}

<div id="select_map_test">
  
{{ macros.select_map(data.type_code, [], areas_container=data.areas_container) }}

</div>

{%- endblock %}


{%- block js_local %}

{{ super() }}

<script src="{{ url_for('static', filename='modules/oeasc/js/util_form.js') }}"></script>
<script src="{{ url_for('static', filename='modules/oeasc/js/util_data.js') }}"></script>
<script src="{{ url_for('static', filename='modules/oeasc/js/util_localisation.js') }}"></script>

<script>

  $(document).ready(function() {

    d_next = {

      'OEASC_COMMUNE' : 'OEASC_SECTION',
      'OEASC_DGD' : 'OEASC_CADASTRE',
      'OEASC_SECTION' : 'OEASC_CADASTRE',
      'OEASC_ONF_FRT' : 'OEASC_ONF_PRF',
      'OEASC_ONF_PRF' : 'OEASC_ONF_UG',

    }

    M.initialiser_form_localisation("select_map_test")

    $('form').submit(function(e) {

      e.preventDefault();

      var type_code = $("form").attr("data-type-code");
      var areas = JSON.parse($("form").attr("data-areas"));

      var id_areas = []

      for(var i=0; i<areas.length; i++) {

        id_areas.push("" + areas[i]["id_area"]);

      }

      id_areas = id_areas.join(",");

      console.log(type_code, areas, id_areas)

      var url_base = $(location).attr('origin') + '/test/carte/'

      if(d_next[type_code]) {

        window.location.href = url_base + d_next[type_code] +"/" + id_areas;

      }

    });

  });

</script>

{%- endblock %}
