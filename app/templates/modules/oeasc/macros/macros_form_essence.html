{# macros_form_essence.html #}

{%- macro select_essence(name, nomenclature, titre="", object=None, multi="", required="required", data_max=3, listes_essences=listes_essences, id_nomenclature_degat_type=-1, afficher_type_essence="", search="true") %}
  <div>

    <div id="{{ name | upper }}" class="{{'select-required' if required else ''}}">

    {%- set ns = namespace() %}

    {%- if titre != "" %}
      <label class="label-question" for="{{ name }}">{{ titre }} 
        <i>
            {%- if multi == "multi" %}
          - <span class="red">(3 essences max.)</span>
              {%- endif %}

          </i><span class="big-red">{{ "*" if required!="" else "" }}</span></label>
    {%- endif %}

    {%- set ns.select_options="" %}

    {%- if multi == "multi" %}
      {%- set ns.select_options = 'data-max-options=3 multiple'%}
    {%- else %}
      {%- set ns.select_options = "show-tick"%}
    {%- endif %}

    <div class={{"select-essence" if afficher_type_essence!="" else ""}}>
      <select data-dropup-auto="true" name="{{ name }}" id="{{ name }}" class="selectpicker" data-live-search="{{'true' if search else 'false'}}" title="{{'Choisir une ou plusieurs essences' if multi else 'Choisir une essence'}}" show-tick {{ns.select_options}} {{required}}  data-width="fit"
      >

    {%- if multi == "multi" %}

      {%- for elem in object[name] %}

        <option selected value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endfor %}

    {%- else %}

      {%- if object[name] %}

        {%- set elem = object[name] %}

        <option selected value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endif %}

    {%- endif %}

    {%- if afficher_type_essence == "" %}

      {%- for elem in listes_essences["degats"][id_nomenclature_degat_type] %}

        <option value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endfor %}

    {%- else %}

        <optgroup label="Feuillus">

      {%- for elem in listes_essences["feuillus"] %}

          <option value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endfor %}

        </optgroup>

        <optgroup label="RÃ©sineux">

      {%- for elem in listes_essences["resineux"] %}

          <option value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endfor %}

        </optgroup>

    {%- endif %}

      </select>
    </div>

    </div>

  </div>

{%- endmacro %}
