{%- macro choix(choix1, choix2, name, title, name_test, object=None) %}

  {%- set ns = namespace(choix1_checked = "") %}
  {%- set ns.choix2_checked = "" %}

  {%- if object[name] == true %}

    {%- set ns.choix1_checked = "checked" %}

  {%- endif %}

  {%- if object[name] == false %}

    {%- set ns.choix2_checked = "checked" %}

  {%- endif %}

  <div>

    <div id=name|upper class="form-question">

      <label class="label-question" for="{{ name }}">{{ title }} <span class="rouge">*</span></label>

      <div class=choice>

        <div class="custom-control custom-radio custom-control-inline">
          <input {{ns.choix1_checked}} id="{{ name }}-0" name="{{ name }}"" type="radio" value="T" required>
          <label class='label-choice' for="{{ name }}-0"> {{ choix1 }} </label>
        </div>

        <div class="custom-control custom-radio custom-control-inline">
          <input {{ns.choix2_checked}} id="{{ name }}-1" name="{{ name }}"" type="radio" value="F" required>
          <label class="labe-choice" for="{{ name }}-1"> {{ choix2 }} </label>
        </div>

      </div>
    </div>

  </div>

{%- endmacro %}


{%- macro select_essence(name, nomenclature, titre="", object=None, multi="", required="required", data_max=3, listes_essences=listes_essences, id_nomenclature_degat_type=-1, afficher_type_essence="") %}
  <div>

    <div id="{{ name | upper }}">

    {%- set ns = namespace() %}

    {%- if titre != "" %}
      <label class="label-question" for="{{ name }}">{{ titre }}<span class="rouge">{{ "*" if required!="" else "" }}</span></label>
    {%- endif %}

    {%- set ns.select_options="" %}

    {%- if multi == "multi" %}
      {%- set ns.select_options = 'data-max-options=3 multiple'%}
    {%- else %}
      {%- set ns.select_options = "show-tick"%}
    {%- endif %}

    <div class={{"select-essence" if afficher_type_essence!="" else ""}}>
      <select data-dropup-auto="true" name="{{ name }}" id="{{ name }}" class="selectpicker" data-live-search="true" title="Pas d'élément choisi" show-tick {{ns.select_options}} {{required}}  data-width="fit">

    {%- if multi == "multi" %}

      {%- for elem in object[name] %}

        <option selected value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endfor %}

    {%- else %}

      {%- if object[name] %}

        {%- set elem = object[name] %}

        <option selected value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endif %}

    {%- endif %}

    {%- if afficher_type_essence == "" %}

      {%- for elem in listes_essences["degats"][id_nomenclature_degat_type] %}

        <option value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endfor %}

    {%- else %}

        <optgroup label="Feuillus">

      {%- for elem in listes_essences["feuillus"] %}

          <option value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endfor %}

        </optgroup>

        <optgroup label="Résineux">

      {%- for elem in listes_essences["resineux"] %}

          <option value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endfor %}

        </optgroup>

    {%- endif %}

      </select>
    </div>

    </div>

  </div>

{%- endmacro %}


{# {%- macro select(name, nomenclature, mnemonique, titre="", object=None, required="required") %}
  <div>

    <div id="{{ name | upper }}">

    {%- set ns = namespace() %}

    {%- if titre != "" %}
      <label for="{{ name }}">{{ titre }}<span class="rouge">{{ "*" if required!="" else "" }}</span></label>
    {%- endif %}

    {%- set ns.select_options = 'multiple' %}


      <select name="{{ name }}" id="{{ name }}" class="selectpicker" data-live-search="true" title="Pas d'élément choisi" show-tick {{ns.select_options}} {{required}} data-width="fit" data-dropup-auto=false>

    {%- for elem in object[name] %}

        <option selected value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

    {%- endfor %}

    {%- for elem in nomenclature[mnemonique]['values'] %}

      {%- set ns.is_checked = false %}

      {%- for ind in object[name] %}

        {%- if elem["id_nomenclature"] == ind%}

          {%- set ns.is_checked = true %}

        {%- endif %}

      {%- endfor %}

      {%- if not ns.is_checked %}

        <option value="{{ elem.id_nomenclature }}">{{ elem.label_fr }}</option>

      {%- endif %}

    {%- endfor %}

      </select>

    </div>

  </div>

{%- endmacro %} #}


{%- macro radio_nomenclature(name, nomenclature, mnemonique, type, titre="", object=None, add="", required="required") %}

{%- if type == "checkbox" and required %}

  {%- set classes = "checkbox-group-required" %}

{%- endif %}

<div>

  <div id="{{ name | upper }}" class="{{classes}}">

    {%- if titre != "" %}

    <label for="{{ name }}">{{ titre }} <i small>{{'(plusieurs réponses possibles)' if type == "checkbox" else ''}}</i> <span class="rouge">{{ "*" if required!="" else "" }}</span></label>

    {%- endif %}

    {%- for elem in nomenclature[mnemonique]['values'] %}

      {%- set ns = namespace(checked="") %}

      {%- if type == "checkbox" %}

        {%- for d in object[name] %}
          {%- if elem.id_nomenclature|string == d["id_nomenclature"]|string %}
            {%- set ns.checked="checked" %}
          {%- endif %}
        {%- endfor %}

      {%- elif object[name] is defined %}

        {%- if elem.id_nomenclature|string == object[name]["id_nomenclature"]|string %}
          {%- set ns.checked = "checked" %}
        {%- endif %}

      {%- endif %}

    <div class="custom-control">

{#       <input id="{{ name }}{{ add|string }}-{{ loop.index0 }}" name="{{ name }}{{ add|string }}" type="{{ type }}" value="{{ elem.id_nomenclature }}" {{ns.checked}} required>
      <label for="{{ name }}{{ add|string }}-{{ loop.index0 }}">{{ elem.label_fr }}</label>
 #}
      <input id="{{ name }}{{ add|string }}-{{ elem.mnemonique | cleanid }}" name="{{ name }}{{ add|string }}" type="{{ type }}" value="{{ elem.id_nomenclature }}" {{ns.checked}} {{required}}>
      <label for="{{ name }}{{ add|string }}-{{ elem.mnemonique | cleanid }}">{{ elem.label_fr }}</label>

    </div>

    {%- endfor %}

  </div>

</div>

{%- endmacro %}


{%- macro input_text(name, titre="", object=None, required="required", disabled="") %}
<div>

  <div id="{{ name | upper }}" class="form-question">
    <label for="{{ name }}">{{ titre }}<span class="rouge">{{ "*" if required!="" else "" }}</span></label>
    <input class="form-control" type="text" name="{{ name }}" id="{{name}}" value="{{ object[name] or '' }}" {{ required }} {{ disabled }} >
  </div>

</div>
{%- endmacro %}


{%- macro input_tel(name, titre="", object=None, required="required", disabled="") %}
<div>

  <div id="{{ name | upper }}" class="form-question">
    <label for="{{ name }}">{{ titre }}<span class="rouge">{{ "*" if required!="" else "" }}</span></label>
    <input class="form-control" type="tel" pattern="[0-9]{10}" name="{{ name }}" id="{{name}}" value="{{ object[name] or '' }}" {{ required }} {{ disabled }} 
    oninvalid="this.setCustomValidity('Entrer un numéro à 10 chiffres, ex 0123456789')"
    oninput="this.setCustomValidity('')">
  </div>

</div>
{%- endmacro %}


{%- macro input_email(name, titre="", object=None, required="required", disabled="") %}
<div>
  
  <div id="{{ name | upper }}" class="form-question">
    <label for="{{ name }}">{{ titre }}<span class="rouge">{{ "*" if required!="" else "" }}</span></label><br>
    <input class="form-control" type="email" name="{{ name }}" id="{{name}}" value="{{ object[name] or '' }}" {{ required }} {{ disabled }} >
  </div>

</div>
{%- endmacro %}


{%- macro input_cp(name, titre="", object=None, required="required", disabled="") %}
<div>

  <div id="{{ name | upper }}" class="form-question">
    <label for="{{ name }}">{{ titre }}<span class="rouge">{{ "*" if required!="" else "" }}</span></label><br>
    <input class="form-control" type="text" pattern="[0-9]{5}" name="{{ name }}" id="{{name}}" value="{{ object[name] or '' }}" {{ required }} {{ disabled }}
    oninvalid="this.setCustomValidity('Entrer un numéro à 5 chiffres, ex 54321')"
    oninput="this.setCustomValidity('')">
  </div>

</div>
{%- endmacro %}


{%- macro input_double(name, titre="", object=None, required="required", disabled="") %}
<div>

  <div id="{{ name | upper }}">
    <label for="{{ name }}">{{ titre }}<span class="rouge">{{ "*" if required!="" }}</span></label><br>
    <input class="form-control" type="number" onchange="(function(el){el.value=parseFloat(el.value).toFixed(0);})(this)" name="{{ name }}" id="{{name}}" value="{{ object[name] or '' }}" {{ required }} {{ disabled }} >
  </div>

</div>
{%- endmacro %}


{%- macro list_areas(type_code, titre, areas, balise) %}

  {%- set areas_selected = utils.get_areas_from_type_code(areas, type_code) %}

  {%- if areas_selected %}

  <{{balise}}>

    {%- for area in areas_selected %}

      {%- if type_code == 'OEASC_COMMUNE' %}
        <b>{{titre + " : " if loop.first}}</b>{{utils.print_commune(area.area_name)}}{{ "," if not loop.last else "." }}
      {% else %}
        <b>{{titre + " : " if loop.first}}</b>{{area.area_name}}{{ "," if not loop.last else "." }}
      {% endif %}

    {%- endfor %}

  </{{balise}}>

  {% endif %}

{% endmacro%}


{%- macro list_nomenclatures(titre, nomenclatures, balise) %}

  {%- if nomenclatures %}

  <{{balise}}>

    {%- for elem in nomenclatures %}

        <b>{{titre + " : " if loop.first}}</b>{{elem.label_fr | nopar | lower}}{{ "," if not loop.last else "." }}
    {%- endfor %}

  </{{balise}}>

  {% endif %}

{% endmacro%}


{%- macro select_map(type_code, areas, areas_container=[],  titre="", b_multiple=true) %}

  {%- set dict_label = {
  "OEASC_ONF_FRT" : "forêts relevant du régime forestier",
  "OEASC_ONF_PRF" : "parcelles forestières",
  "OEASC_ONF_UG" : "unités de gestion forestières",
  "OEASC_DGD" : "forêts possédant un document de gestion",
  "OEASC_CADASTRE" : "parcelles cadastrales",
  "OEASC_SECTION" : "sections cadastrales",
  "OEASC_COMMUNE" : "communes",
  } %}

  {%- set dict_label_elem = {
  "OEASC_ONF_FRT" : "la forêt concernée",
  "OEASC_ONF_PRF" : "la ou les parcelles forestières sur lesquelles est située le peuplement concerné par les dégats",
  "OEASC_ONF_UG" : "la ou les unités de gestion forestières sur lesquelles est située le peuplement concerné par les dégats",
  "OEASC_DGD" : "la forêt",
  "OEASC_CADASTRE" : "la ou les parcelles forestières cadastrales sur lesquelles est située le peuplement concerné par les dégats",
  "OEASC_SECTION" : "la ou les sections cadastrales concernées",
  "OEASC_COMMUNE" : "la ou les communes concernées",
  } %}

  {%- set dict_label_container = {
  "OEASC_ONF_FRT" : "Forêt relevant du régime forestier",
  "OEASC_ONF_PRF" : "Parcelles forestières",
  "OEASC_DGD" : "Forêt possédant un document de gestion",
  "OEASC_SECTION" : "Sections cadastrales",
  "OEASC_COMMUNE" : "Communes",
  } %}

<div id="select_map_{{ type_code }}" class="select_map" data-type-code='{{ type_code }}'  data-areas-container='{{ areas_container|tojson if areas_container is defined else [] }}'>

  <h4>Localisation : {{dict_label[type_code]}}</h4>

  <p>Veuillez sélectionner {{dict_label_elem[type_code]}}.<br>
  Choisir parmi celles figurant sur la carte ci-dessous ou dans la liste ci-contre.<label for="tooltip_{{ type_code }}"></label></p>

  <div class="row">

    <div class="col-md-8">

      <div id="form_localisation_map_{{ type_code }}">
        <div id="map_{{type_code}}" class="map"></div>
        <div id="infos_map" class="infos_map"></div>
        <div id="chargement">
          <div>Chargement en cours <span class="fa fa-spinner"></span></div>
        </div>
      </div>

    </div>

    <div class="col-md-4">

      {%- if areas_container %}

      <div>

        <p> {{ dict_label_container[areas_container[0]["type_code"]] }} </p>

        <div class="scroll">
          <ul>
            {%- for area in areas_container %}

            <li>{{area['area_name']}} {{ "(" + area['area_code'] + ")" if area['type_code'] == 'OEASC_SECTION' else ''}}</li>

            {% endfor %}
          </ul>
        </div>

        {% if type_code in ['OEASC_SECTION', 'OEASC_ONF_UG'] %}

        <button type=button id="reinit_container" class="btn btn-danger">Revenir au choix des {{ dict_label_container[areas_container[0]["type_code"]] | lower }}</button>

        {% endif %}

      </div>

      {% endif %}

      <div class="localisation-select form-group">

        {% if b_multiple %}

          {% set multiple = 'multiple data-actions-box="true"' %}

        {% else %}

          {% set multiple = '' %}

        {% endif %}

        <div><label for="{{ type_code }}">Liste des {{ dict_label[type_code] }}<span class="rouge">*</span></label></div>
        {# <select data-dropup-auto="false" name="{{ type_code }}" id="{{ type_code }}" title="Choisir un element dans la liste" {{ multiple }} required class="selectpicker" data-width="fit" data-live-search="true"> #}
        <select data-dropup-auto="true" name="{{ type_code }}" id="{{ type_code }}" title="Choisir un element dans la liste" {{ multiple }} required class="selectpicker" data-width="fit" data-live-search="true">
        </select>
      </div>

   <input type=submit value=Suivant class="btn btn-success float-right">




    </div>

  </div>

</div>

{%- endmacro %}
