{%- import "modules/oeasc/macros/macros_form.html" as macros_form %}
{%- import "modules/oeasc/macros/macros_form_map.html" as macros_map %}

<div id="form_foret" data-id-foret="{{ foret.id_foret or ''}}"></div>

<form id="form_foret_statut">

  <h4>Statut de la forêt</h4>

<div>
  <div class="center">
  <div class="form-group">
  {{ macros_form.choix("Public", "Privé", 'b_statut_public' ,'Statut de la forêt', object=foret) }}

  {%- if foret.b_statut_public == true or foret.b_statut_public == false %}

    {%- if foret.b_statut_public == true %}

      {%- set titre_document = "La forêt relève-t-elle du régime forestier ?" %}

    {%- else %}

      {%- set titre_document = "La forêt est-elle dotée d'un document de gestion durable ?" %}

    {%- endif %}

    {{ macros_form.choix("Oui", "Non" ,'b_document' ,titre_document , object=foret) }}


  {%- endif %}
</div>
  </div>
</div>

  {%- if foret.b_statut_public == false %}

  <p><i>Document de gestion durable = plan simple de gestion (PSG) ou code de bonnes pratiques sylvicoles (CBPS)</i></p>

  {%- endif %}

  <div><p><i><span class="rouge">*</span> Obligatoire.</i></p></div>

<div class="align-right">
  <input type=submit value=Suivant class="btn btn-success">
</div>

</form>

<form id="form_areas_foret" data-areas='{{ foret["areas_foret"]|tojson if foret["areas_foret"] is defined else [] }}'>

{# cas ONF #}
{%- if foret['b_statut_public'] == true and foret['b_document'] == true %}

  {% set areas_selected = utils.get_areas_from_type_code(foret["areas_foret"], "OEASC_ONF_FRT")%}

  {{ macros_map.select_map("OEASC_ONF_FRT", areas_selected, b_multiple=false, titre="Forêt relevant du régime forestier") }}

{# cas DGD #}
{%- elif foret['b_statut_public']==false and foret['b_document'] ==true %}

  {% set areas_selected = utils.get_areas_from_type_code(foret["areas_foret"], "OEASC_DGD")%}

  {{ macros_map.select_map("OEASC_DGD", areas_selected, b_multiple=false) }}

{# cas autres (communes et sections) #}
{%- elif foret['b_document'] == false %}

  {% set areas_selected = utils.get_areas_from_type_code(foret["areas_foret"], "OEASC_COMMUNE")%}

  {% if not areas_selected %}

    {{ macros_map.select_map("OEASC_COMMUNE", areas_selected) }}

  {% else %}

    {% set areas_container = utils.get_areas_from_type_code(foret["areas_foret"], "OEASC_COMMUNE")%}
    {% set areas_selected = utils.get_areas_from_type_code(foret["areas_foret"], "OEASC_SECTION")%}

    {% if areas_container %}

      {{ macros_map.select_map("OEASC_SECTION", areas_selected, areas_container) }}

    {% endif %}

  {% endif %}

{%- endif %}

  <div><p><i><span class="rouge">*</span> Obligatoire.</i></p></div>


</form>


<form id="form_information_foret">

  <h4>Informations sur la forêt</h4>

  {%- set disabled=''%}

  {%- if foret["b_document"]==true  %}

  <div>

    <p>Le nom de la forêt et sa superficie sont issues {{ "des données transmises par l’ONF relatives aux forêts relevant du régime forestier" if foret["b_statut_public"] else "de données relatives aux forêts privées ayant un document de gestion" }}. Ces informations ne peuvent être modifiées. Si vous constatez une erreur, merci de l’indiquer dans le cadre dédié aux commentaires libres, en fin de formulaire, ou de contacter l’animateur de l’Observatoire.</p>

    <br>

    <p>Veuillez cliquer sur « Suivant ».</p>

  </div>
  {%- set disabled='disabled'%}

  {%- endif %}

<div class="center">

  <div class="form-group form-text">

  {{ macros_form.input_text("label_foret", "Nom de la forêt", foret, required='', disabled=disabled) }}

  {{ macros_form.input_double("surface_renseignee", "Superficie totale de la forêt (ha)", foret, required='' if foret['b_document'] else "required", disabled=disabled) }}

  </div>

</div>

  <div><p><i><span class="rouge">*</span> Obligatoire.</i></p></div>

  <div class="align-right">

    <input type=submit value=Suivant class="btn btn-success">

  </div>

</form>


{%- set proprietaire = foret.proprietaire %}
{%- include "modules/oeasc/form/form_proprietaire.html" %}
