{%- block declarations %}

{%- import "modules/oeasc/macros/macros_display.html" as macros_display %}

<div id="declarations">

  <div id="data_declarations">

    {%- for declaration in declarations %}
    <div class="data-declaration" data-declaration='{{ declaration | tojson if declaration else "" }}' style="display:none;"></div>
    {%- endfor %}

  </div>

  <nav class="nav nav-tabs">
    <a class="nav-item nav-link active" href="#resutats" data-toggle="tab" data-type="TC">Tableau + carte</a>
    <a class="nav-item nav-link" href="#resultats" data-toggle="tab" data-type="T">Tableau</a>
    <a class="nav-item nav-link" href="#resultats" data-toggle="tab" data-type="C">Carte</a>
  </nav>

  <div class="tab-pane active" id="resultats">

    <div class="row">

      <div id='tableau_declarations' class="col-md-6">

        <h2>Liste de déclarations</h2>

        <table id="table_declarations" class="table-striped table-small">

          <thead>

            <tr>

              <th>ID</th>
              <th>Déclarant</th>
              <th>Organisme</th>
              <th>Date</th>
              <th>Nom forêt</th>
              <th>Commune(s)</th>
              {# <th>Proprietaire</th> #}
              <th>Parcelles</th>
              <th>Ess. objectif</th>
              <th>Type peuplement</th>
              <th>Origine</th>
              {# <th>Gravité</th> #}
              <th>Type dégâts</th>
              <th>Voir / Modifier</th>

            </tr>

          </thead>

          <tbody>

            {%- for declaration in declarations %}

            {%- if session.current_user %}
            {%- set cond_modifier_effacer = (session.current_user.id_droit_max >= 4) or (session.current_user.id_role == declaration.id_declarant) %}
            {%- else %}
            {%- set cond_modifier_effacer = false %}
            {%- endif %}



            <tr>
              <td>{{ declaration['id_declaration'] }}</td>

              <td>{{ declaration['declarant'] }}</td>

              <td>{{ declaration['organisme']}}</td>

              <td>{{utils.print_date(declaration['date'])}}</td>

              <td>{{declaration['label_foret']}}</td>

              <td>{{ macros_display.list_areas('OEASC_COMMUNE', '', declaration["areas_foret"]) }}</td>

              <td>
                {{ macros_display.list_areas('OEASC_CADASTRE', '', declaration["areas_localisation"]) }}
                {{ macros_display.list_areas('OEASC_ONF_PRF', '', declaration["areas_localisation"]) }}
                {{ macros_display.list_areas('OEASC_ONF_UG', '', declaration["areas_localisation"]) }}
              </td>
              {# <td>{{ "Public" if declaration['b_statut_public'] else "Privé"}}</td>

              {%- if declaration.b_document %}

              <td>{{ "Régime ONF" if declaration.b_statut_public else "DGD" }}</td>

              {%- else %}

              <td>Non documentée</td>

              {%- endif %} #}
              <td>
                <b>{{ macros_display.tooltip_mnemonique(declaration.id_nomenclature_peuplement_essence_principale) }}</b>
                {{macros_display.tooltip_mnemonique(declaration.nomenclatures_peuplement_essence_secondaire)}}
              </td>

              <td>{{macros_display.tooltip_mnemonique(declaration.id_nomenclature_peuplement_type)}}</td>

              <td>{{macros_display.tooltip_mnemonique(declaration.id_nomenclature_peuplement_origine)}}</td>

              {# <td>{{macros_display.tooltip_mnemonique(declaration.gravite)}}</td> #}

              <td>{{macros_display.tooltip_mnemonique(declaration.nomenclatures_degat_type)}}</td>

              <td>
                <a href="{{ url_for('oeasc.declaration', id_declaration=declaration['id_declaration'])}}">
                  <span class="fas fa-eye"></span>
                </a>
              

              {%- if cond_modifier_effacer %}

              
                <a href="{{ url_for('oeasc.modifier_declaration', id_declaration=declaration['id_declaration'])}}">
                  <span class="fas fa-pen"></span>
                </a>
              </td>

              {#           <td>
                <a href="#">
                  <button type="button" data-id-declaration="{{ declaration['id_declaration'] }}" title="Supprimer la déclaration" class="button-supprimer-declaration btn btn-danger"><span class="fas fa-times"></span></button>
                </a>
              </td> #}

              {%- else %}

              <td></td>
              {# <td></td> #}

              {%- endif %}

            </tr>

            {%- endfor %}

          </tbody>

        </table>

      </div>

      <div id="show_declarations"  class="col-md-6">

        <div id="map_show_declarations" class="map"></div>

        <div id="infos_map" class="infos_map"></div>

        <div id="chargement">

          <div>Chargement en cours <span class="fa fa-spinner"></span></div>

        </div>

      </div>

    </div>

  </div>

</div>

{%- endblock %}

