{%- block declarations %}

<div id="declarations">

  <div id="data_declarations">

    {%- for declaration in declarations %}
    <div class="data-declaration" data-declaration='{{declaration}}' style="display:none;"></div>
    {%- endfor %}

  </div>

  <div id='liste_declarations'>
    <h2>Liste de délaration</h2>

    <table id="table_declarations" class="table-striped">

      <thead>

        <tr>
          <th>ID</th>
          <th>Organisme</th>
          <th>Statut</th>
          <th>Documentée</th>
          <th>Essence Objectif Principale</th>
          <th>Gravité</th>
          <th>Action</th>
        </tr>

      </thead>

      <tbody>

        {%- for declaration in declarations %}

        {%- if session.current_user %}

        {%- set cond_modifier_effacer = (session.current_user.id_droit_max > utils.get_fonction_droit("Directeur")) or (session.current_user.id_role == declaration.id_declarant)%}

        {%- else %}

        {%- set cond_modifier_effacer = false %}

        {%- endif %}

        <tr>

          <td>{{ declaration['id_declaration'] }}</td>

          <td>{{ utils.get_organisme_name_from_id_declarant(declaration['id_declarant'])}}</td>

          <td>{{ "Public" if declaration['foret']['b_statut_public'] else "Privé"}}</td>

          {%- if declaration.foret.b_document %}

          <td>{{ "Régime ONF" if declaration.foret.b_statut_public else "DGD" }}</td>

          {%- else %}

          <td>Non documentée</td>

          {%- endif %}

          <td>{{ utils.get_nomenclature_from_id(declaration.id_nomenclature_peuplement_essence_principale, nomenclature) }}</td>

          <td>{{ utils.get_gravite(declaration, nomenclature) }}</td>

          <td>

            <a href="{{ url_for('oeasc.declaration', id_declaration=declaration['id_declaration'])}}">
              <button type="button" title="Voir la déclaration" class="button-voir-declaration btn btn-info"><span class="fas fa-eye"></span></button>
            </a>


            {%- if cond_modifier_effacer %}

            <a href="{{ url_for('oeasc.modifier_declaration', id_declaration=declaration['id_declaration'])}}">
              <button type="button" title="Modifier la déclaration" class="button-modifier-declaration btn btn-primary"><span class="fas fa-pen"></span></button>
            </a>

            <a href="#">
              <button type="button" data-id-declaration="{{ declaration['id_declaration'] }}" title="Supprimer la déclaration" class="button-supprimer-declaration btn btn-danger"><span class="fas fa-times"></span></button>
            </a>

            {%- else %}

            {%- endif %}

          </td>

        </tr>

        {%- endfor %}

      </tbody>

    </table>

  </div>

  <div id="show_declarations">

    <div id="map_show_declarations" class="map"></div>

    <div id="infos_map" class="infos_map"></div>

    <div id="chargement">

      <div>Chargement en cours <span class="fa fa-spinner"></span></div>

    </div>

  </div>


</div>

{%- endblock %}

